<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ChessMaster Pro - Advanced Digital Chess Platform</title>

  <!-- Chessboard.js CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard.min.css" integrity="sha512-2WwLfRJYkVr3WkPSXdr9L+1+/XcG7VDD3uXPtR4qRstL8jG+m0nCk80v6wZfGyYh7xN3aPwhZ+Q4k1iP1zctqA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin:0;
      padding:0;
      color:white;
    }

    header {
      padding:1rem 2rem;
      background: rgba(0,0,0,0.85);
      text-align:center;
      font-size:1.8rem;
      font-weight:bold;
      border-bottom:2px solid #ffd700;
    }

    .container {
      max-width: 1000px;
      margin: 2rem auto;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #chessboard {
      width: 560px;
    }

    .game-info {
      margin-top: 1rem;
      text-align: center;
    }

    .move-history {
      margin-top:1rem;
      max-height:200px;
      overflow-y:auto;
      width:100%;
      background: rgba(0,0,0,0.3);
      padding:1rem;
      border-radius:15px;
    }

    .move-item {
      font-family: monospace;
      display:flex;
      justify-content: space-between;
      padding:0.25rem 0;
    }

    /* Promotion Modal */
    .modal {
      display: none;
      position: fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background: rgba(0,0,0,0.8);
      z-index:1000;
      justify-content:center;
      align-items:center;
    }

    .modal-content {
      background:white;
      color:black;
      padding:2rem;
      border-radius:20px;
      text-align:center;
    }

    .promotion-piece {
      font-size:3rem;
      margin:1rem;
      cursor:pointer;
      padding:0.5rem;
      border:2px solid #ccc;
      border-radius:10px;
      transition: all 0.3s;
    }

    .promotion-piece:hover {
      background:#ffd700;
      transform: scale(1.1);
    }

  </style>
</head>
<body>
  <header>ChessMaster Pro â™”</header>

  <div class="container">
    <div id="chessboard"></div>
    <div class="game-info">
      <p>Turn: <span id="turnIndicator">White</span></p>
    </div>
    <div class="move-history" id="moveHistory">
      <h4>Move History</h4>
    </div>
  </div>

  <!-- Promotion Modal -->
  <div id="promotionModal" class="modal">
    <div class="modal-content">
      <h3>Promote Pawn</h3>
      <div id="promotionOptions"></div>
    </div>
  </div>

  <!-- Dependencies -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/1.0.0/chess.min.js" integrity="sha512-L8hO4vj7G5TX6+sZHj3+IB4gZ3zYbYlA7ULzU0GMe/0aKp7+PZr9+8xw3V0+74jCrEzf9pxaf5B0cRi3FFOcZA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard.min.js" integrity="sha512-Gi2rMl5q4zXg6Cbs5T+fVkvk3KKMzLz+ZfUKmIJ/zBZyZSkh+r0NRwOLrC7pA/9MPMnn38apUOb9H9hZg1P9Lw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    const game = new Chess();

    const board = Chessboard('chessboard', {
      draggable: true,
      position: 'start',
      onDragStart: onDragStart,
      onDrop: onDrop,
      onSnapEnd: onSnapEnd
    });

    const turnIndicator = document.getElementById('turnIndicator');
    const moveHistoryEl = document.getElementById('moveHistory');

    function onDragStart(source, piece, position, orientation) {
      if (game.game_over()) return false;
      if ((game.turn() === 'w' && piece.search(/^b/) !== -1) ||
          (game.turn() === 'b' && piece.search(/^w/) !== -1)) {
        return false;
      }
    }

    function onDrop(source, target, piece, newPos, oldPos, orientation) {
      let move = game.move({from: source, to: target, promotion:'q'}); // auto queen
      if (move === null) return 'snapback';

      updateMoveHistory();
      turnIndicator.textContent = game.turn() === 'w' ? 'White' : 'Black';

      // Pawn promotion handling
      if(move.flags.includes('p') && (move.to[1]==='8' || move.to[1]==='1')){
        showPromotionModal(move.to, move.color);
      }
    }

    function onSnapEnd() {
      board.position(game.fen());
    }

    function updateMoveHistory() {
      moveHistoryEl.innerHTML = '<h4>Move History</h4>';
      game.history({verbose:true}).forEach((m, i)=>{
        const div = document.createElement('div');
        div.classList.add('move-item');
        div.textContent = `${i+1}. ${m.san}`;
        moveHistoryEl.appendChild(div);
      });
      moveHistoryEl.scrollTop = moveHistoryEl.scrollHeight;
    }

    // Promotion modal
    const promotionModal = document.getElementById('promotionModal');
    const promotionOptions = document.getElementById('promotionOptions');

    function showPromotionModal(square, color) {
      promotionModal.style.display = 'flex';
      promotionOptions.innerHTML = '';
      const pieces = ['q','r','b','n'];
      pieces.forEach(p=>{
        const pieceEl = document.createElement('div');
        pieceEl.classList.add('promotion-piece');
        pieceEl.textContent = color==='w' ? p.toUpperCase() : p;
        pieceEl.onclick = ()=>{
          game.move({from:square, to:square, promotion:p});
          board.position(game.fen());
          promotionModal.style.display = 'none';
          updateMoveHistory();
        };
        promotionOptions.appendChild(pieceEl);
      });
    }

    promotionModal.onclick = e => {
      if(e.target === promotionModal) promotionModal.style.display = 'none';
    }

  </script>
</body>
</html>